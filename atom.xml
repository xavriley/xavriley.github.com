<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Xavier Riley ||= Web Developer, Guildford]]></title>
  <link href="http://xavriley.github.com/atom.xml" rel="self"/>
  <link href="http://xavriley.github.com/"/>
  <updated>2012-01-21T17:26:33+00:00</updated>
  <id>http://xavriley.github.com/</id>
  <author>
    <name><![CDATA[Xavier Riley]]></name>
    <email><![CDATA[info@xavierriley.co.uk]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Transferring Customers From Prestashop To Magento]]></title>
    <link href="http://xavriley.github.com/blog/2010/09/03/transferring-customers-from-prestashop-to-magento/"/>
    <updated>2010-09-03T00:00:00+01:00</updated>
    <id>http://xavriley.github.com/blog/2010/09/03/transferring-customers-from-prestashop-to-magento</id>
    <content type="html"><![CDATA[<p>There’s always debate about which ecommerce platform is harder/better/faster/stronger, and from experience of Prestashop and Magento I can say they’re both really good for different types of shops. For <a href="http::www.forsyths.co.uk/">Forsyths</a>, I developed a Prestashop solution for their Sheet Music department whilst I was working there and it’s been great so far but…</p>

<p><del>When picking a solution it really pays to do some forward planning and in this case, Prestashop can’t scale up to the kind of multi-store functionality that this music department store needed. That said, it was a lot easier getting a Prestashop store off the ground (I tried both at the start) and it’s served us well. My only gripe is that Prestashop’s module and templating system isn’t flexible enough to make real changes without editing the core – and that screws up future updates. Not what you need for ecommerce purposes.</del></p>

<p><em>UPDATE</em>
Since writing this, it&#8217;s all change with Prestashop v1.5
They&#8217;ve had a basic overrides system in place for a while now.
Also the new version supports multistore but I haven&#8217;t used it, yet&#8230;</p>

<p>** Making the switch</p>

<p>Swapping out the products from PS to Mage is pretty straightforward – it’s just a case of a mysql query which maps them into the right fields. As with any Magento import the process is more or less similar;</p>

<ul>
<li>Add some dummy data into Magento, using all the fields you’re likely to use</li>
<li>Export the data as a csv using System > Import/Export > Profiles</li>
<li>Look at the file in your var/export folder and take a look at the headers</li>
</ul>


<p>Tip for *nix users working with csv files – in terminal use the following command to save the first two lines to a file;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>head -n 2 your_csv_file.csv &gt; your_csv_file_head.csv
</span></code></pre></td></tr></table></div></figure>


<p>That’s if your csv file is really big.</p>

<p>** The problem with users</p>

<p>Now the above works fine for most things, but the problem with users lies in the different authentication that both shops use. Magento uses MD5 with a salt on the end, Prestashop uses a ‘Cookie Key’ prefix to the customer password, which is then MD5 encrypted.
Anyone who’s looked into MD5 knows that this is a pig – you can’t reverse an MD5 into plain text, therefore you can’t get the original password strings in order to re-encode them (which is actually a good thing…).</p>

<p>** How to fix it</p>

<p>Clearly its impossible to convert from one MD5 hash to another so we have to try something different. Make the following file;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>magentoroot<span class="o">)</span>/app/code/local/Mage/Customer/Model/Customer.php
</span></code></pre></td></tr></table></div></figure>


<p>and in it put the following;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">class Mage_Customer_Model_Customer extends Mage_Core_Model_Abstract</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">/**</span>
</span><span class='line'><span class="x">* Authenticate customer</span>
</span><span class='line'><span class="x">*</span>
</span><span class='line'><span class="x">* @param string $login</span>
</span><span class='line'><span class="x">* @param string $password</span>
</span><span class='line'><span class="x">* @return true</span>
</span><span class='line'><span class="x">* @throws Exception</span>
</span><span class='line'><span class="x">*/</span>
</span><span class='line'><span class="x">public function authenticate($login, $password)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'>
</span><span class='line'><span class="x">$this-&gt;loadByEmail($login);</span>
</span><span class='line'><span class="x">if ($this-&gt;getConfirmation() &amp;&amp; $this-&gt;isConfirmationRequired()) {</span>
</span><span class='line'><span class="x">throw Mage::exception(&#39;Mage_Core&#39;, Mage::helper(&#39;customer&#39;)-&gt;__(&#39;This account is not confirmed.&#39;),</span>
</span><span class='line'><span class="x">self::EXCEPTION_EMAIL_NOT_CONFIRMED</span>
</span><span class='line'><span class="x">);</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'><span class="x">if (!$this-&gt;validatePassword($password) &amp;&amp; !$this-&gt;validatePassword(&#39;hKvthisisyourgibberishcookiestringfromprestashopCM&#39;.$password)) {</span>
</span><span class='line'><span class="x">throw Mage::exception(&#39;Mage_Core&#39;, Mage::helper(&#39;customer&#39;)-&gt;__(&#39;Invalid login or password.&#39;),</span>
</span><span class='line'><span class="x">self::EXCEPTION_INVALID_EMAIL_OR_PASSWORD</span>
</span><span class='line'><span class="x">);</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'><span class="x">Mage::dispatchEvent(&#39;customer_customer_authenticated&#39;, array(</span>
</span><span class='line'><span class="x">&#39;model&#39; =&gt; $this,</span>
</span><span class='line'><span class="x">&#39;password&#39; =&gt; $password,</span>
</span><span class='line'><span class="x">));</span>
</span><span class='line'><span class="x">return true;</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'>
</span><span class='line'><span class="x">//end class</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice the random string prepended to the password variable? That’s your cookie string which you’ll find in your Prestashop install here;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">(prestshop root)/config/settings.inc.php</span>
</span></code></pre></td></tr></table></div></figure>


<p>It’s the line beginning</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">define(&#39;_COOKIE_KEY_&#39;, &#39;ThisIsTheBitYouWant...&#39; </span>
</span></code></pre></td></tr></table></div></figure>


<p>Believe it or not that’s all you need to do. Import your MD5 hashes from Prestashop straight into Magento and it’ll authenticate them as Prestashop would do. I’ll go through the mysql import in another post.</p>
]]></content>
  </entry>
  
</feed>
