<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Xavier Riley]]></title><description><![CDATA[Blogging about programming, companies and music.]]></description><link>http://my-ghost-blog.com/</link><generator>Ghost v0.4.1</generator><lastBuildDate>Sat, 01 Mar 2014 18:05:48 GMT</lastBuildDate><atom:link href="http://my-ghost-blog.com/rss/" rel="self" type="application/rss+xml"/><author><![CDATA[Xavier Riley]]></author><ttl>60</ttl><item><title><![CDATA[(Re)Starting a blog with Ghost]]></title><description><![CDATA[<p>I like to ramble on as much as the next person, but up till now it's mostly been offline. To save my wife from hearing me talk about programming and tax law I'm making like it's 2004 and (re)starting a blog. Properly this time. Like with actual content and everything.</p>

<h3 id="discoveringghost">Discovering Ghost</h3>

<p>For past blogging attempts I've used Wordpress (easy) and Jekyll (hackable) and neither were much fun. As a developer I want something that's easy <em>and</em> hackable and I'm hoping that the node based Ghost fits the bill.</p>

<p>I get to write Markdown (win) with a nice javascript-based preview window, and the posts save to an SQLite database. </p>

<h4 id="installation">Installation</h4>

<pre><code>wget https://ghost.org/zip/ghost-0.4.1.zip
unzip ghost-0.4.1.zip
cd ghost-0.4.1
brew update
brew install node
npm install --production
npm start
</code></pre>

<p>Very nice!</p>

<h4 id="hosting">Hosting</h4>

<p>I'd been hosting up to now on Github pages which to be honest has been a giant PITA (mainly because of issues with Octopress). I'm looking at moving to Heroku but in the interests of getting up and running quickly, I used <a href='https://github.com/axitkhurana/buster' >buster</a> to generate a static site from my local Ghost install.</p>

<pre><code>sudo pip install buster
buster setup --gh-repo=git@github.com:xavriley/xavriley.github.com.git
buster generate --domain=http://localhost:2368
buster preview # browse localhost:9000 to check
buster add-domain xavierriley.co.uk
buster deploy
</code></pre>

<p>Except in my case <code>buster deploy</code> failed because of my existing Octopress blog in that repo. After taking a fresh clone to backup the old blog, I deployed by:</p>

<pre><code>cd  static # where buster makes it's repo
git push -f origin master
</code></pre>

<p>which <em>blows away the old repo</em> and lets me deploy normally from then on.</p>

<h5 id="forbonuspoints">For bonus points</h5>

<p>To make the deploy process smoother, try running:</p>

<pre><code>sudo sh -c 'echo "127.0.0.1 local.tryghost.org" &gt;&gt; /etc/hosts'
</code></pre>

<p>to be able to run <code>buster generate</code> with no extra args.</p>

<h4 id="conclusion">Conclusion</h4>

<p>From discovering Ghost to deploying to Github pages took about 15 minutes and I didn't have any issue that held me up for more than about 10 seconds. Now I've been programming professionally for the last six years and I can honestly say <a href='http://joearms.github.io/2014/02/07/why-programming-is-difficult.html' >that doesn't happen very often</a>.</p>]]></description><link>http://my-ghost-blog.com/blogging-with-ghost-buster-and-github-pages/</link><guid isPermaLink="false">e4bf4dbf-a9c8-4452-9e33-f20d07c94a47</guid><category><![CDATA[Getting Started]]></category><dc:creator><![CDATA[Xavier Riley]]></dc:creator><pubDate>Sat, 01 Mar 2014 14:15:32 GMT</pubDate></item><item><title><![CDATA[Test driving Prestashop with Behat, Mink and Selenium - Step by step]]></title><description><![CDATA[<p>Whilst I don't do so much PHP development nowdays, I've been watching <br />
the current rennaissance with interest. PHP is taking note of trends <br />
being pushed by the Rails world with "clean and classy" frameworks such <br />
as <a href='http://laravel.com/' >Laravel</a> and best practice manifestos like <a href='http://www.phptherightway.com/' >PHP the right <br />
way</a> coming to light. This is all good <br />
news for the web because better quality code (whatever language it's <br />
written in) raises the bar all round. </p>

<p>That said, there still seems to be a lack of good documentation <br />
concerning proper Behaviour Driven Development (BDD) with PHP and it's a <br />
problem that we came across recently at <a href='http://kyan.com/' >Kyan</a>. I'm going to try and do a <br />
walkthrough of setting up some simple fetaure testing using a default <br />
install of the <a href='http://www.prestashop.com/' >Prestashop</a> ecommerce <br />
framework. It's a fairly sizeable project that doesn't ship with test <br />
coverage - let's fix that!</p>

<h2 id="whatyoullneed">What you'll need</h2>

<ul>
<li>A local install of <a href='http://www.prestashop.com/' >Prestashop</a></li>
<li><a href='http://www.mozilla.org/en-US/firefox/new/' >Firefox</a> (just the standard consumer version, not Aurora or nightly)</li>
<li><a href='http://selenium.googlecode.com/files/selenium-server-standalone-2.25.0.jar' >Selenium RC (2.25.0 at the time of writing)</a></li>
<li><p>PHP 5.4 (just so we're all on the same page)</p></li>
<li><p><a href='http://behat.org/' >Behat (a PHP testing framework)</a> </p></li>
<li><a href='http://mink.behat.org/' >Mink (web acceptance testing for Behat)</a> </li>
<li><a href='http://getcomposer.org/' >Composer (a PHP packaging tool - think Bundler for PHP)</a> </li>
</ul>

<p>&nbsp;</p>

<h3 id="1installprestashop">1.) Install Prestashop</h3>

<p>Prestashop has a good set of instructions so I won't duplicate them all <br />
here. Suffice to say you need to set up a MySQL db and change a few <br />
permissions.</p>

<h3 id="2installcomposer">2.) Install Composer</h3>

<p>Make sure PHP is in your path. You can test this by firing up terminal <br />
and typing</p>

<pre><code class="bash">php -v  
</code></pre>

<p>If you're using MAMP, put something like <br />
this at the bottom of your <code>.bashrc</code></p>

<pre><code class="bash">export PATH="/Applications/MAMP/bin/:$PATH"  
</code></pre>

<p>Double check the path to the MAMP binaries. It's different in different <br />
versions of MAMP.</p>

<p>Now <code>cd</code> into your newly created prestashop folder and run the following <br />
commands to install composer;</p>

<pre><code>mkdir bin  
curl -s https://getcomposer.org/installer | php -- --install-dir=bin  
</code></pre>

<p>If you're installing using the default OSX apache and you get an error <br />
about "detect_unicode = Off", you'll also need to <br />
run the following;</p>

<pre><code>sudo su  
echo "detect_unicode = Off" &gt;&gt; /private/etc/php.ini  
apachectl restart  
exit  
</code></pre>

<h3 id="3installbehatandmink">3.) Install Behat and Mink</h3>

<p>This part is the reason I'm writing this blog post. There seems to be a <br />
lack of clear information about how to get these up and running from <br />
scratch. Hopefully this will be sorted out as time goes on but I would <br />
suggest people submit their points about what works and doesn't work for <br />
them.</p>

<p>To get started, make a file called <code>composer.json</code> in the root of the <br />
Prestashop install and put in the following;</p>

<pre><code class="json">{
    "require": {
        "behat/behat":           "2.4@stable",
        "behat/mink-extension":  "*",
        "behat/mink-goutte-driver":     "*",
        "behat/mink-selenium2-driver":  "*"
    },
    "minimum-stability": "dev",
    "config": {
        "bin-dir": "bin"
    }
}
</code></pre>

<p>This is the equivalent of a Gemfile if you've used bundler and Ruby. So <br />
to get everything up and running, run composer like so.</p>

<pre><code>php bin/composer.phar install  
</code></pre>

<p>All being, well you should see the packages installing into a vendor <br />
folder in the project root.</p>

<h3 id="4settingupbehat">4.) Setting up Behat</h3>

<pre><code class="bash">&gt; bin/behat --init                     
+d features - place your *.feature files here
+d features/bootstrap - place bootstrap scripts and static files here
+f features/bootstrap/FeatureContext.php - place your feature related code here
</code></pre>

<p>This bootstraps the files needed to run the tests. Let's go ahead and <br />
write our first test. Usually in test driven development, we write the <br />
tests before the code, but I'm advocating here that we can add tests to <br />
and exisiting site to give us the confidence to refactor and add <br />
features later on. Start editing /features/basket.feature and put in <br />
the following;</p>

<pre><code class="gherkin">Feature: Basket  
  In order to add a product to the basket
  As a website user
  I need to add the product to my basket
  And I should see the product in the basket 

  @javascript
  Scenario: Add a product to basket
    Given I am on a product page
    When I click "Add to cart"
    And I hover over "#shopping_cart a"
    Then I should see the product title 
</code></pre>

<p>This is an example of a Cucumber test (the natural language syntax is <br />
referred to as Gherkin) which is a popular way of doing acceptance <br />
testing in Rails and other frameworks. We proceed by running the test <br />
like so;</p>

<pre><code class="bash">&gt; bin/behat
Feature: Basket  
  In order to add a product to the basket
  As a website user
  I need to add the product to my basket
  And I should see the product in the basket

  @javascript
  Scenario: Add a product to basket     # features/basket.feature:8
    Given I am on a product page
    When I click on "Add to cart"
    And I hover over "#shopping_cart a"
    Then I should see the product title

1 scenario (1 undefined)  
4 steps (4 undefined)  
0m0.039s

You can implement step definitions for undefined steps with these snippets:

    /**
     * @Given /^I am on a product page$/
     */
    public function iAmOnAProductPage()
    {
        throw new PendingException();
    }

    /**
     * @When /^I click "([^"]*)"$/
     */
    public function iClick($arg1)
    {
        throw new PendingException();
    }

    /**
     * @Given /^I hover over "([^"]*)"$/
     */
    public function iHoverOver($arg1)
    {
        throw new PendingException();
    }

    /**
     * @Then /^I should see the product title$/
     */
    public function iShouldSeeTheProductTitle()
    {
        throw new PendingException();
    }
</code></pre>

<p>This runs the test and tells you what to do next. Copy the snippets into <br />
the <code>features/bootstrap/FeatureContext.php</code> file above the final <br />
curly brace. After saving and running <code>bin/behat</code> again, the output should change to include </p>

<pre><code>TODO: write pending definition  
</code></pre>

<h3 id="5enablemink">5.) Enable Mink</h3>

<p>This is where the documentation starts to part ways with the latest <br />
versions of Mink and Behat. After struggling with the official run <br />
through at <a href='http://mink.behat.org/' >http://mink.behat.org/</a> trying to <br />
get Zombie working as the Javascript client, I stumbled across the Mink <br />
example repository in the Behat official Github page here <br />
<a href='https://github.com/Behat/MinkExtension-example' >https://github.com/Behat/MinkExtension-example</a></p>

<p>The key is swapping out <code>BehatContext</code> in the <code>FeaturesContext</code> file, to <br />
make sure that it reads;</p>

<pre><code class="php">class FeatureContext extends Behat\MinkExtension\Context\MinkContext  
</code></pre>

<p>and then you need to configure Behat and Mink to be looking in the right <br />
places and choosing the correct browser drivers. Make a file called <br />
<code>behat.yml</code> in the root of the project with the following;</p>

<pre><code class="yaml">default:  
  context:
    class:  'FeatureContext'
  extensions:
    Behat\MinkExtension\Extension:
      base_url:  'http://tdd.prestashopexample.com/'
      goutte:    ~
      selenium2: ~
</code></pre>

<p><code>goutte</code> seems to be a requirement as far as I can tell, but who
knows...</p>

<p>Now when you run <code>bin/behat</code> again, you should see an error like this;</p>

<pre><code>Curl error thrown for http POST to http://localhost:4444/wd/hub/session with params: {"desiredCapabilities":{"browserName":"firefox","version":"8","platform":"ANY","browserVersion":"8","browser":"firefox"},"requiredCapabilities":[]}  
</code></pre>

<p>Enter Selenium...</p>

<h3 id="6settingupselenium">6.) Setting up selenium</h3>

<p>This should be quite straightforward. First off, make sure you have the <br />
standard version of Firefox installed. Download Selenium RC from the link <br />
at the top of the page and move the <code>.jar</code> file to the <code>vendor/</code> folder. <br />
Then run the following command to start the Selenium server;</p>

<pre><code>java -jar vendor/selenium-server-standalone-2.25.0.jar &gt; /dev/null &amp;  
</code></pre>

<p>You should see <code>INFO: Launching a standalone server</code> and you're good to <br />
try the tests again by running <code>bin/behat</code>. This time you'll see Firefox <br />
start up, flash up with the page content and close again. The first test <br />
passed! Now let's implement the others.</p>

<h3 id="7finishingthesteps">7.) Finishing the steps</h3>

<p>Change the methods in <code>FeatureContext.php</code> to look like this;</p>

<pre><code class="php">    /**
     * @Given /^I hover over "([^"]*)"$/
     */
    public function iHoverOver($arg1)
    {
        $this-&gt;getSession()-&gt;getPage()-&gt;find('css', $arg1)-&gt;mouseOver();
        $this-&gt;getSession()-&gt;wait(5000, "$('#cart_block_list').hasClass('expanded')");
    }

    /**
     * @Then /^I should see the product title$/
     */
    public function iShouldSeeTheProductTitle()
    {
        $product_title = $this-&gt;getSession()-&gt;getPage()-&gt;find('css', '.cart_block_product_name');
        $product_title == "iPod Nano";
    }
</code></pre>

<p>A few things to note here before we proceed - this isn't a very robust <br />
test and could be improved. There's duplication all over the place which <br />
could be refactored (but it's late and I've just got it working...). The <br />
real problem is that it's assuming the title of the product as the <br />
assertion in the last point. A better approch would be to call/mock the <br />
product from Prestashop in the constructor and use that instead. Maybe <br />
in part 2.</p>

<p>Also, it bugged me that the <code>wait-&gt;(...)</code> call which executes JS is <br />
executed in the context of the session. It makes perfect sense in <br />
hindsight as <code>getPage</code> is returning a sort of DOM object but it tripped <br />
me up nonetheless.</p>

<p>Down to business - run <code>bin/behat</code> one last time and the output should <br />
look like this;</p>

<pre><code class="bash">&gt; bin/behat                                                                                       1 ↵
Feature: Basket  
  In order to add a product to the basket
  As a website user
  I need to add the product to my basket
  And I should see the product in the basket

  @javascript
  Scenario: Add a product to basket     # features/basket.feature:8
    Given I am on a product page        # FeatureContext::iAmOnAProductPage()
    When I click on "Add to cart"       # FeatureContext::iClickOn()
    And I hover over "#shopping_cart a" # FeatureContext::iHoverOver()
    Then I should see the product title # FeatureContext::iShouldSeeTheProductTitle()

1 scenario (1 passed)  
4 steps (4 passed)  
0m4.056s  
</code></pre>

<p>Happy days!</p>

<h2 id="conclusion">Conclusion</h2>

<p>There's a ton of PHP apps out there that would benefit from regression <br />
tests like this. They're not that hard to write once you get going and <br />
they give you an invaluable safety net and peace of mind when it comes <br />
to refactoring and adding new features. </p>

<p>My motivation for writing this was that the current state of documentation <br />
seems a bit patchy, despite the Behat and Mink projects being well established. <br />
I suppose this is a call to arms to PHP devs to try this stuff out <br />
and get their feedback into the loop. </p>

<p>I'd love to see more advanced posts dealing with the various drivers <br />
that are available and also to hear what people think of <br />
this one. I'll finish by saying I'm starting out on this trail so my advice <br />
is only what I've managed to cobble together up to now. If there's <br />
improvements or suggestions in the comments I'll happily fold them back in to <br />
the main post. Happy testing...</p>]]></description><link>http://my-ghost-blog.com/test-driving-prestashop-with-behat-mink-and-selenium-step-by-step/</link><guid isPermaLink="false">7ee0d4e7-8147-4a94-ae2b-63e29c9747cc</guid><category><![CDATA[php, prestashop, TDD, acceptance testing, cucumber, behat, mink, selenium, tutorial]]></category><dc:creator><![CDATA[Xavier Riley]]></dc:creator><pubDate>Wed, 12 Dec 2012 12:00:00 GMT</pubDate></item><item><title><![CDATA[Migrating customers from Prestashop to Magento]]></title><description><![CDATA[<p>There’s always debate about which ecommerce platform is harder/better/faster/stronger, and from experience of Prestashop and Magento I can say they’re both really good for different types of shops. For <a href='http://my-ghost-blog.com/:www.forsyths.co.uk/' >Forsyths</a>, I developed a Prestashop solution for their Sheet Music department whilst I was working there and it’s been great so far but…</p>

<p><del>When picking a solution it really pays to do some forward planning and in this case, Prestashop can’t scale up to the kind of multi-store functionality that this music department store needed. That said, it was a lot easier getting a Prestashop store off the ground (I tried both at the start) and it’s served us well. My only gripe is that Prestashop’s module and templating system isn’t flexible enough to make real changes without editing the core – and that screws up future updates. Not what you need for ecommerce purposes.</del></p>

<p><em>UPDATE</em> <br />
Since writing this, it's all change with Prestashop v1.5 <br />
They've had a basic overrides system in place for a while now. <br />
Also the new version supports multistore but I haven't used it, yet...</p>

<h2 id="makingtheswitch">Making the switch</h2>

<p>Swapping out the products from PS to Mage is pretty straightforward – it’s just a case of a mysql query which maps them into the right fields. As with any Magento import the process is more or less similar;</p>

<ul>
<li>Add some dummy data into Magento, using all the fields you’re likely to use</li>
<li>Export the data as a csv using System > Import/Export > Profiles</li>
<li>Look at the file in your var/export folder and take a look at the headers</li>
</ul>

<p>Tip for *nix users working with csv files – in terminal use the following command to save the first two lines to a file;</p>

<pre><code class="shell">head -n 2 your_csv_file.csv &gt; your_csv_file_head.csv  
</code></pre>

<p>That’s if your csv file is really big.</p>

<h2 id="theproblemwithusers">The problem with users</h2>

<p>Now the above works fine for most things, but the problem with users lies in the different authentication that both shops use. Magento uses MD5 with a salt on the end, Prestashop uses a ‘Cookie Key’ prefix to the customer password, which is then MD5 encrypted. <br />
Anyone who’s looked into MD5 knows that this is a pig – you can’t reverse an MD5 into plain text, therefore you can’t get the original password strings in order to re-encode them (which is actually a good thing…).</p>

<h2 id="howtofixit">How to fix it</h2>

<p>Clearly its impossible to convert from one MD5 hash to another so we have to try something different. Make the following file;</p>

<pre><code>(magentoroot)/app/code/local/Mage/Customer/Model/Customer.php
</code></pre>

<p>and in it put the following;</p>

<pre><code class="php">class Mage_Customer_Model_Customer extends Mage_Core_Model_Abstract  
{
/**
* Authenticate customer
*
* @param string $login
* @param string $password
* @return true
* @throws Exception
*/
public function authenticate($login, $password)  
{

$this-&gt;loadByEmail($login);
if ($this-&gt;getConfirmation() &amp;&amp; $this-&gt;isConfirmationRequired()) {  
throw Mage::exception('Mage_Core', Mage::helper('customer')-&gt;__('This account is not confirmed.'),  
self::EXCEPTION_EMAIL_NOT_CONFIRMED  
);
}
if (!$this-&gt;validatePassword($password) &amp;&amp; !$this-&gt;validatePassword('hKvthisisyourgibberishcookiestringfromprestashopCM'.$password)) {  
throw Mage::exception('Mage_Core', Mage::helper('customer')-&gt;__('Invalid login or password.'),  
self::EXCEPTION_INVALID_EMAIL_OR_PASSWORD  
);
}
Mage::dispatchEvent('customer_customer_authenticated', array(  
'model' =&gt; $this,  
'password' =&gt; $password,  
));
return true;  
}

//end class
}
}
</code></pre>

<p>Notice the random string prepended to the password variable? That’s your cookie string which you’ll find in your Prestashop install here;</p>

<pre><code>(prestshop root)/config/settings.inc.php
</code></pre>

<p>It’s the line beginning</p>

<pre><code class="php">define('_COOKIE_KEY_', 'ThisIsTheBitYouWant...'  
</code></pre>

<p>Believe it or not that’s all you need to do. Import your MD5 hashes from Prestashop straight into Magento and it’ll authenticate them as Prestashop would do. I’ll go through the mysql import in another post.</p>]]></description><link>http://my-ghost-blog.com/migrating-customers-from-prestashop-to-magento/</link><guid isPermaLink="false">68fff6ae-7372-4beb-91ab-97327137320e</guid><category><![CDATA[php, prestashop]]></category><dc:creator><![CDATA[Xavier Riley]]></dc:creator><pubDate>Thu, 03 Sep 2009 11:00:00 GMT</pubDate></item></channel></rss>